// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Individu
model Individu {
  code              String          @id @default(uuid())
  
  // signification: Nom de l'individu
  // exemple: Terrieur
  nom               String


  // signification: Prénom de l'individu
  // exemple: Alex
  prenom            String


  // signification: Date de naissance de l'individu
  // exemple: 29.02.1988
  dateNaissance     DateTime


  // signification: Adresse de l'individu (Ssimplifié)
  // exemple: 3 rue du Boulevard
  adresse           String

  // spécifique Prisma
  formateur         Formateur[]
  apprenant         Apprenant[]
}

model Formateur {
  // signification: Numéro unique de formateur
  // exemple: 
  codeFormateur     Int          @id @default(autoincrement())
  
  // Héritage et spécificité Prisma
  codeIndividu      String
  individu          Individu        @relation(fields: [codeIndividu], references: [code], onDelete: Cascade)
  module            Module[]
  formation         Formation[]
}

model Apprenant {
  // signification: Numéro unique d'Apprenant
  // exemple:
  codeApprenant     Int          @id @default(autoincrement())

  // Héritage et spécificité Prisma
  codeIndividu      String
  individu          Individu        @relation(fields: [codeIndividu], references: [code], onDelete: Cascade)

  // Liaison Apprenant Inscription
  inscription       Inscription[]
}

// Formation & Module
model Formation {
  // signification: Numéro de la Formation
  // exemple:
  codeFormation     String          @id @default(uuid())

  // signification: Titre de la formation
  // exemple: Concepteur Développeur d'Asticot (CDA)
  titre             String

  // signification: date de création de la formation
  // exemple: 14.07.2022
  dateCreation      DateTime        @default(now())

  // signification: date de publication de la formation
  // exemple: 15.07.2022
  datePublication   DateTime

  // signification: Listing des modules
  // exemple: ...
  // Liaison avec les modules
  formationModule   FormationModule[]

  // Auteur de la formation
  codeFormateur     Int
  formateur         Formateur        @relation(fields: [codeFormateur], references: [codeFormateur], onDelete: Cascade)

  // Liaison Apprenant Inscription
  inscription       Inscription[]
}

model Module {
  // signification: Numéro de module
  // exemple:
  codeModule        String          @id @default(uuid())
  intitule          String

  // signification: Objectif Pédagogique (description ?)
  // exemple:
  objectif          String


  // signification: "Simplifié", le contenu peut avoir
  //                soit du texte, de l'image, de la vidéo
  contenuTexte           String?
  contenuImage           String?
  contenuVideo           String?

  // signification: Indication de la durée du module en heures
  // exemple: 05h
  duree             String
  
  // Liaison avec les formations
  formationModule   FormationModule[]
  
  // Liaison avec les tags (1, n)
  moduleTag         ModuleTag[]

  // Auteur du module
  codeFormateur     Int
  formateur         Formateur        @relation(fields: [codeFormateur], references: [codeFormateur], onDelete: Cascade)
}

// Liaison entre une formation et les modules
model FormationModule {
  @@unique([codeModule, codeFormation], name: "combinaisonFormationModule")

  // signification: chapitrage en versioning semantic
  // exemple: 1.0
  chapitre          String

  // signification: status du module (validé ou non)
  // exemple: true
  status            Boolean

  // une formation contient plusieurs modules
  // un module peut se retrouver dans plusieurs formations
  codeFormation     String
  formation         Formation        @relation(fields: [codeFormation], references: [codeFormation], onDelete: Cascade)
  codeModule        String
  module            Module        @relation(fields: [codeModule], references: [codeModule], onDelete: Cascade)
}


// Liaison entre les modules et les tags
model ModuleTag{
  @@unique([codeModule, codeTag], name: "combinaisonModuleTag")

  // un module peut avoir 1 à n tags
  // un tags peut se retrouver dans plusieurs modules
  codeModule        String
  module            Module        @relation(fields: [codeModule], references: [codeModule], onDelete: Cascade)
  codeTag           String
  tag               Tag        @relation(fields: [codeTag], references: [codeTag], onDelete: Cascade)
}

model Tag {
  // signification: Numéro de tag
  // exemple:
  codeTag        String          @id @default(uuid())
  // signification: Valeur du tag
  // exemple: Mobile
  valeur         String

  // liaison avec les modules
  moduleTag              ModuleTag[]
}


// Liaison entre les apprenant et les formations
model Inscription {
  @@unique([codeFormation, codeApprenant], name: "combinaisonInscription")

  // un apprenant peut suivre plusieurs formations
  // une formation peut être suivie par plusieurs apprenants
  codeFormation        String
  formation            Formation        @relation(fields: [codeFormation], references: [codeFormation], onDelete: Cascade)
  codeApprenant        Int
  apprenant            Apprenant        @relation(fields: [codeApprenant], references: [codeApprenant], onDelete: Cascade)
}
